<div id="mobile-menu" class="fixed inset-0 z-50 hidden">
  <div
    id="mobile-menu-overlay"
    class="fixed inset-0 bg-black/50 backdrop-blur-sm transition-opacity duration-300 opacity-0"
  >
  </div>
  <div
    id="mobile-menu-content"
    class="fixed top-0 right-0 h-full w-72 bg-white shadow-xl transition-transform duration-300 transform translate-x-full flex flex-col p-3"
  >
    <button
      id="mobile-menu-close"
      class="self-end text-gray-500 hover:text-gray-700 mb-8"
      aria-label="Cerrar menú"
    >
      <svg
        class="w-8 h-8"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M6 18L18 6M6 6l12 12"></path>
      </svg>
    </button>

    <nav class="flex-1 flex flex-col items-center justify-center space-y-12">
      <a href="/" class="text-xl font-medium text-gray-800 hover:text-emerald-600 transition-colors">
        Inicio
      </a>
      <a href="/nosotros" class="text-xl font-medium text-gray-800 hover:text-emerald-600 transition-colors">
        ¿Quiénes Somos?
      </a>
      <a href="/#servicios" class="text-xl font-medium text-gray-800 hover:text-emerald-600 transition-colors">
        Servicios
      </a>
    </nav>
    <div class="mt-auto pt-6 w-full">
      <a href="/contacto" class="block w-full px-6 py-3 bg-emerald-600 hover:bg-emerald-700 text-white text-center rounded-full font-medium transition-colors">
        Contáctanos
      </a>
    </div>
  </div>
</div>

<script>
  // @ts-nocheck
  class MobileMenu {
    private menu: HTMLElement | null;
    private overlay: HTMLElement | null;
    private content: HTMLElement | null;
    private openButton: HTMLElement | null;
    private closeButton: HTMLElement | null;
    private isOpen: boolean;

    constructor() {
      this.menu = document.getElementById('mobile-menu');
      this.overlay = document.getElementById('mobile-menu-overlay');
      this.content = document.getElementById('mobile-menu-content');
      this.openButton = document.getElementById('mobile-menu-button');
      this.closeButton = document.getElementById('mobile-menu-close');
      this.isOpen = false;

      this.init();
    }

    private init(): void {
      // Toggle menu when clicking the hamburger button
      this.openButton?.addEventListener('click', () => this.toggle());

      // Close menu when clicking the close button
      this.closeButton?.addEventListener('click', () => this.close());

      // Close menu when clicking outside
      this.overlay?.addEventListener('click', () => this.close());

      // Close menu when clicking on a link
      this.content?.querySelectorAll('a').forEach((link) => {
        link.addEventListener('click', () => this.close());
      });

      // Close menu on route change
      document.addEventListener('astro:before-preparation', () => this.close());
    }

    private toggle(): void {
      if (this.isOpen) {
        this.close();
      } else {
        this.open();
      }
    }

    private open(): void {
      if (this.isOpen) return;
      this.isOpen = true;
      document.body.style.overflow = 'hidden';
      this.menu.classList.remove('hidden');

      // Trigger reflow
      void this.menu.offsetHeight;

      this.overlay.classList.add('opacity-100');
      this.overlay.classList.remove('opacity-0');
      this.content.classList.remove('translate-x-full');
      this.openButton?.setAttribute('aria-expanded', 'true');
    }

    private close(): void {
      if (!this.isOpen) return;
      this.isOpen = false;
      document.body.style.overflow = '';

      this.overlay.classList.remove('opacity-100');
      this.overlay.classList.add('opacity-0');
      this.content.classList.add('translate-x-full');
      this.openButton?.setAttribute('aria-expanded', 'false');

      // Wait for the animation to complete before hiding the menu
      setTimeout(() => {
        if (!this.isOpen) {
          this.menu.classList.add('hidden');
        }
      }, 300);
    }
  }

  // Initialize the mobile menu when the DOM is loaded
  document.addEventListener('DOMContentLoaded', () => {
    new MobileMenu();
  });
</script>
